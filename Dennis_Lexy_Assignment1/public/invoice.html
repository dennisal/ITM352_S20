<script src="./services_data.js" type="text/javascript"> //uses get request for the product list
    let params = (new URL(document.location)).searchParams;
    var quantities = [];
    // processing the invoice to create the form from the data entered
    if (params.has('purchase_submit_button')) { // loop that pulls information
        for (i = 0; i < services_array.length; i++) {
            if (params.has(`quantity${i}`)) {
                a_qty = params.get(`quantity${i}`);
                quantities[i] = a_qty;
            }
        }

    } else {
        document.write('Please enter a valid amount');
    }
    console.log(quantities);
        //GET = {};
        //params.forEach(function (value, key) { GET[key] = value });
</script>

<!-- Copied from order_page_Ex4.html in Lab13 -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>
    <link href="./assets/css/main.css" rel="stylesheet">
</head>

<body>
    <!-- Table design taken from Invoice1_1 as displayed in the Assignment 1 directions page -->
    <table border=2>
        <tbody>
            <tr>
                <th style="text-align: center;" width="43%">Item</th>
                <th style="text-align: center;" width="11%">quantity</th>
                <th style="text-align: center;" width="54%">extended price</th>
                <th style="text-align: center;" width="13%">price</th>
            </tr>

            <!-- The script will get the information to fill in the above table from the quantities selected by the user on the home page -->
            <script>
                subtotal = 0;
                for (i = 0; i < services_array.length; i++) {
                    if (quantities[i] > 0) {
                        // product row
                        extended_price = quantities[i] * services_array[i].price
                        subtotal += extended_price;
                        document.write(`
                            <tr>
                                <td width="43%">${services_array[i].tour}</td>
                                <td align="center" width="11%">${quantities[i]}</td>
                                <td width="13%">\$${services_array[i].price}</td>
                                <td width="54%">\$${extended_price}</td>
                            </tr>
                        `);
                    }
                }
                // Compute tax
                var tax_rate = 0.0575;
                var tax = tax_rate * subtotal;

                // Compute grand total
                var total = subtotal + tax;
            </script>

            <tr>
                <td colspan="4" width="100%">&nbsp;</td>
            </tr>
            <tr>
                <td style="text-align: center;" colspan="3" width="67%">Sub-total</td>
                <td width="54%">$
                    <script>document.write(subtotal);</script>
                </td>
            </tr>
            <tr>
                <td style="text-align: center;" colspan="3" width="67%"><span style="font-family: arial;">Tax @
                        <script>document.write(100 * tax_rate);</script>%</span></td>
                <td width="54%">$
                    <script>document.write(tax.toFixed(2));</script>
                </td>
            </tr>
            <tr>
                <td style="text-align: center;" colspan="3" width="67%"><strong>Total</strong></td>
                <td width="54%"><strong>$
                        <script>document.write(total.toFixed(2));</script></strong></td>
            </tr>

        </tbody>
    </table>

</body>

</html>

<!-- May not need the below code
<script>
        if (typeof POST['services_array'] != 'undefined') {
            quantity_form['services_array'].value = q;
        }
    }
</script>