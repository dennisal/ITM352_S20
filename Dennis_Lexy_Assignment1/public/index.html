<!DOCTYPE HTML>
<!--
	Used the following Epilogue template by TEMPLATED
	templated.co @templatedco
	Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
-->
<html>

<head>

    <title>Spanish City Tours</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/templated-epilogue/assets/css/main.css" />

    <script> //Taken from order_page_Ex4.html

        function checkQuantityTextbox(theTextbox) {
            errs = isNonNegInt(theTextbox.value, true);
            document.getElementById(theTextbox.name + '_message').innerHTML = errs.join(", ");
        }

        function isNonNegInt(q, return_errors = false) {
            errors = []; // assume no errors at first
            if (q == '') q = 0; // handle blank inputs as if they are 0
            if (Number(q) != q) errors.push('<font color="red">Not a number</font>'); // Check if string is a number value
            if (q < 0) errors.push('<font color="red">Negative value</font>'); // Check if it is non-negative
            if (parseInt(q) != q) errors.push('<font color="red">Not a full tour</font>'); // Check that it is an integer
            return return_errors ? errors : (errors.length == 0);
        }

        window.onload = function () {
            let params = (new URL(document.location)).searchParams; // get the query string which has the form data
            // form was submitted so check that quantities are valid then redirect to invoice if ok.
            if (params.has('purchase_submit_button')) {
                errors = false; // assume quantities are valid from the start
                total_qty = 0; // need to check if something was selected so we will look if the total > 0
                //For every product in the array, write the product number, display its image and name, and list price
                for (i = 0; i < services_array.length; i++) {
                    if (params.has(`quantity${i}`)) {
                        a_qty = params.get(`quantity${i}`);
                        // make textboxes sticky in case of invalid data
                        quantity_form[`quantity${i}`].value = a_qty;
                        total_qty += a_qty;
                        if (!isNonNegInt(a_qty)) {
                            errors = true; // oops, invalid quantity
                            checkQuantityTextbox(quantity_form[`quantity${i}`]); // show where the error is
                        }
                    }
                }
                // Now respond to errors or redirect to invoice if all is ok
                if (errors) {
                    alert("Please only enter valid amounts");
                } else if (total_qty == 0) { // no quantity selections, just give a general alert
                    alert("Please select tour amounts");
                } else { // all good to go!
                    window.location = `./invoice.html${document.location.search}`; //Redirects itself
                    window.stop;
                }
            }
        }

    </script>

    <script src="./services_data.js" type="text/javascript"></script>
    <script src="/templated-epilogue/assets/js/jquery.min.js"></script>
    <script src="/templated-epilogue/assets/js/skel.min.js"></script>
    <script src="/templated-epilogue/assets/js/util.js"></script>
    <script src="/templated-epilogue/assets/js/main.js"></script>

</head>

<header id="header" class="alt">
    <div class="inner">
        <h1>Spanish City Tours</h1>
        <p>Day Tours in Spain's 5 Most Exciting Cities</p>
    </div>
</header>

<body>

    <div id="wrapper">

        <!-- Display page content in form to process invoice from content -->
        <form name='quantity_form' action="/process_form" method="POST">

            <section class="main items">
                <script> //Referenced products_display.html in SmartPhoneProducts3 WOD for loop
                    for (i = 0; i < services_array.length; i++) { //Loop to display tours, information is being uploaded from services_data.js
                        document.write(`
                    <article class="item">
                        <section>
                            <header>
                                <a href="#textbox${i}" style="background-image"><img src="${services_array[i].image}"></a>
                                <h3>${services_array[i].tour}</h3>
                            </header>
                            <p>
                                ${services_array[i].description}
                            </p>
                            <p>
                                Duration: ${services_array[i].length}
                                <br></br>
                                Price: $${services_array[i].price}
                            </p>
                            <ul class="actions">
                                <li>
                                    <input id="textbox${i}" class="button" type="text" name="quantity_textbox${i}" placeholder="Enter # of Tours Here" onkeyup="checkQuantityTextbox(this);">
                                    <br></br>
                                    <span id="quantity_textbox${i}_message"></span>
                                </li>
                            </ul> 
                        </section>
                    </article>`)
                    };
                </script>
            </section>

            <!-- Calculating invoice for purchased tours -->
            <section id="cta" class="main special">
                <h2>Order Review</h2>
                <p>Please review your chosen amount of tours before submitting your order.</p>
                <br></br>
                <!-- Purchase button that will redirect to the invoice page -->
                <ul class="actions">
                    <li>
                        <input type="submit" value='Purchase' class="button big" name="purchase_submit_button">
                    </li>
                </ul>
            </section>

        </form>

    </div>

    <!-- Footer -->
    <footer id="footer">

        <ul class="icons">
            <li><a href="https://twitter.com/login" class="icon fa-twitter" target=_blank><span
                        class="label">Twitter</span></a></li>
            <li><a href="https://www.facebook.com/login" class="icon fa-facebook" target=_blank><span
                        class="label">Facebook</span></a></li>
            <li><a href="https://www.instagram.com" class="icon fa-instagram" target=_blank><span
                        class="label">Instagram</span></a></li>
            <li><a href="https://www.linkedin.com/login" class="icon fa-linkedin" target=_blank><span
                        class="label">LinkedIn</span></a></li>
            <li><a href="https://www.gmail.com" class="icon fa-envelope" target=_blank><span
                        class="label">Email</span></a></li>
        </ul>

        <p class="copyright">&copy; Untitled. Design:
            <a href="https://templated.co" target=_blank>TEMPLATED</a>.
            Images:
            <a href="https://st3.idealista.com/cms/archivos/2018-06/news/madrid%20gtres.jpg?fv=fgKZ4mOm"
                target=_blank>Idealista</a>,
            <!-- Madrid image -->
            <a href="https://www.gailytour.com/mediafiles/1394/crop/870x442/gaily_tour_seville.jpg" target=_blank>Gaily
                Tour</a>,
            <!-- Seville image -->
            <a href="https://www.roadaffair.com/wp-content/uploads/2019/03/alhambra-granada-spain-shutterstock_336721367-1024x683.jpg"
                target=_blank>Road Affair</a>,
            <!-- Granada image -->
            <a href="https://images.squarespace-cdn.com/content/5910a37720099e49cdd7f274/1494584854229-EZELR0COP3U43MZCLS9V/shutterstock_101032684.jpg?content-type=image%2Fjpeg"
                target=_blank>Squarespace</a>,
            <!-- Barcelona image -->
            <a href="https://www.sweetdeal.dk/media/catalog/product/cache/4e20fae452996c8cd9ca5823333c00e9/v/a/valencia-130220-1.jpg"
                target=_blank>Sweet Deal</a>.
            <!-- Valencia image -->
        </p>

    </footer>

</body>

</html>
<script>
    if (typeof POST['quantity_textbox'] != 'undefined') {
        quantity_form['quantity_textbox'].value = q;
    }
</script>